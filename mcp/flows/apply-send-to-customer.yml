name: apply-send-to-customer
description: Agent applies the "Send to Customer" macro on a conversation
steps:
  - type: goto
    url: env.KAYAKO_AGENT_URL
  - type: expect-visible
    selectorKey: login.submitButton
  - type: fill
    selectorKey: login.emailInput
    value: env.KAYAKO_USERNAME
  - type: fill
    selectorKey: login.passwordInput
    value: env.KAYAKO_PASSWORD
  - type: click
    selectorKey: login.submitButton
  # If a conversation ID is provided in env, open it directly
  - type: goto-conversation-by-env-id
    optional: true
  - type: wait
    value: "200"
    optional: true
  # Fallback to opening first conversation from inbox if direct ID not used/fails
  - type: goto
    url: env.KAYAKO_CONVERSATIONS_URL
    optional: true
  - type: expect-visible
    selectorKey: inbox.conversationSubject
    optional: true
  - type: click
    selectorKey: inbox.conversationSubject
    optional: true
  - type: wait-loadstate
    state: networkidle
    optional: true
  # Apply macro (try resilient CSS first, then text)
  - type: dispatch-click
    selectorKey: macro.macroSelectorTrigger
    optional: true
  - type: wait
    value: "200"
    optional: true
  - type: dispatch-click
    selectorKey: macro.macroOptionSendToCustomer
    optional: true
  - type: dispatch-click-text
    value: "Send to Customer"
  - type: wait-loadstate
    state: networkidle
    optional: true
  - type: wait
    value: "5000"


