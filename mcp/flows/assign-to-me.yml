name: assign-to-me
description: Agent opens first conversation and assigns it to self
steps:
  - type: goto
    url: env.KAYAKO_AGENT_URL
  - type: expect-visible
    selectorKey: login.submitButton
  - type: fill
    selectorKey: login.emailInput
    value: env.KAYAKO_USERNAME
  - type: fill
    selectorKey: login.passwordInput
    value: env.KAYAKO_PASSWORD
  - type: click
    selectorKey: login.submitButton
  # Prefer a specific ticket (ID 5) if it loads; otherwise fall back to the list flow
  - type: goto
    url: env.KAYAKO_CONVERSATIONS_URL/5
    optional: true
  - type: wait
    value: "200"
    optional: true
  - type: goto
    url: env.KAYAKO_CONVERSATIONS_URL
  - type: expect-visible
    selectorKey: inbox.conversationSubject
  - type: click
    selectorKey: inbox.conversationSubject
  # Properties panel path: open Assignee, choose a team to force change, then click Update
  - type: dispatch-click-text
    value: "Assignee"
    optional: true
  - type: wait
    value: "200"
    optional: true
  - type: dispatch-click-text
    value: "General"
    optional: true
  - type: wait
    value: "250"
    optional: true
  - type: dispatch-click-text
    value: "Update properties"
    optional: true
  - type: wait
    value: "250"
    optional: true
  - type: dispatch-click-text
    value: "VIP Account Team"
    optional: true
  - type: wait
    value: "250"
    optional: true
  - type: dispatch-click-text
    value: "Update properties"
    optional: true
  # Try composer footer "Assign to me" path first (optional attempts)
  - type: dispatch-click
    selectorKey: assign.assignToMeTrigger
    optional: true
  - type: wait
    value: "200"
    optional: true
  - type: dispatch-click-text
    value: "General"
    optional: true
  # If no change detected (button might not appear), try VIP to force a change
  - type: dispatch-click-text
    value: "VIP Account Team"
    optional: true
  - type: wait
    value: "200"
    optional: true
  # Persist changes via Update properties (span dispatch first, then button)
  - type: dispatch-click
    selectorKey: assign.updatePropertiesSpan
    optional: true
  - type: wait
    value: "250"
    optional: true
  - type: dispatch-click-text
    value: "Update properties"
    optional: true
  - type: expect-visible
    selectorKey: assign.confirmation
    optional: true


